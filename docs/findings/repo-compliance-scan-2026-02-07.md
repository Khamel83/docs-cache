# Repo Compliance Findings - 2026-02-07

**Scan**: All ~/github repos against cached documentation patterns
**Docs Checked**: FastAPI, Tailscale, Traefik, Convex, Click
**Repos Scanned**: 36 (24 had findings)

---

## Executive Summary

| Category | Compliant | Non-Compliant | Notes |
|----------|-----------|---------------|-------|
| **Click CLI (Python)** | 3 repos | 9 repos | 9 repos using argparse instead of Click |
| **FastAPI** | - | 8 repos | Active usage, not documented as standard |
| **Tailscale Funnel** | 2 repos | - | relayq uses funnel correctly |
| **Traefik** | - | 2 repos | homelab, kid-friendly-ai have configs |

---

## Anti-Patterns Found

### 1. argparse vs Click (9 repos)

**Cached Doc**: `cache/tools/typer/README.md` shows Typer (FastAPI of CLIs)
**Oneshot Rule**: `~/.claude/rules/cli.md` → "Use Click for CLI"

| Repo | Files Using argparse | Should Use |
|------|---------------------|------------|
| vdd | 5 files | click |
| atlas-voice | 3 files | click |
| ralex | 20+ files (MCP servers) | click |
| Podemos | 1 file | click |
| WFM | 1 file | click |
| arb | 1 file | click |
| archon | 1 file | click |
| atlas-code | 1 file | click |
| atlas-coder | 1 file | click |

**Fix Pattern**:
```python
# Before (argparse)
import argparse
parser = argparse.ArgumentParser()
parser.add_argument("name")

# After (Click)
import click
@click.command()
@click.argument("name")
def main(name):
    pass
```

---

### 2. FastAPI Usage (8 repos)

**Cached Doc**: `cache/python/fastapi/README.md` shows FastAPI patterns
**Issue**: Oneshot rules say "Convex for backend, not FastAPI"

| Repo | Files | Pattern |
|------|-------|---------|
| atlas | 51 files | FastAPI with async, Pydantic |
| dada | 28 files | FastAPI |
| archon | 17 files | FastAPI (mostly tests) |
| gmail-bookmark-service | 3 files | FastAPI |
| frugalos | 2 files | FastAPI |
| gaas | 1 file | FastAPI |
| trojanhorse | 1 file | FastAPI |
| atlas-voice | 1 file | FastAPI |

**Observation**: These repos use FastAPI **correctly** according to FastAPI docs (async def, Pydantic models, proper patterns). The issue is architectural preference, not incorrect usage.

---

### 3. Tailscale Patterns

**Cached Doc**: `cache/services/tailscale/README.md` documents `tailscale funnel` and `tailscale serve`

**Good Usage (relayq)**:
```bash
tailscale funnel https://relayq.khamel.com:8080
```
- Uses funnel for public access
- Proper Tailscale Funnel pattern

**Oneshot Usage**:
- References Tailscale in hooks/context
- No direct funnel usage (framework code)

---

### 4. Traefik Usage

**Cached Doc**: `cache/tools/traefik/README.md` documents EntryPoints, Routers, Services

**Found In**:
- `homelab/` - Infrastructure, expected use
- `kid-friendly-ai/` - docker-compose with nginx/traefik labels

**Status**: Legitimate infrastructure use, not an anti-pattern in this context.

---

## Docs Cache Gaps

The following patterns are in code but **not cached**:

| Tool | Usage Count | Should Cache? |
|------|-------------|---------------|
| **pytest** | ~100+ test files | Yes - testing patterns |
| **pydantic** | ~50 files | Yes - validation patterns |
| **httpx** | ~20 files | Yes - HTTP client patterns |
| **uvicorn** | ~15 files | Yes - ASGI server patterns |

---

## Recommendations

### For Oneshot Rules
1. **Clarify FastAPI stance**: Either document as acceptable for services, or migrate examples to Convex
2. **Click migration**: Create `/migrate-to-click` skill for argparse→Click conversion
3. **Cache more docs**: Add pytest, pydantic, httpx to docs cache

### For Individual Repos
| Priority | Repo | Action |
|----------|------|--------|
| High | vdd | Migrate 5 argparse→Click |
| High | ralex | Migrate 20+ argparse→Click |
| Medium | atlas-voice | Migrate 3 argparse→Click |
| Low | homelab | Keep Traefik (infrastructure) |

---

## Compliance Score by Repo

| Repo | Score | Notes |
|------|-------|-------|
| oneshot | ✅ 95% | weather-cli fixed to Click |
| relayq | ✅ 90% | Good Tailscale Funnel usage |
| vig | ✅ 100% | Clean, no anti-patterns |
| networth | ✅ 100% | Clean |
| poytz | ✅ 100% | Clean |
| vdd | ⚠️ 60% | argparse anti-patterns |
| ralex | ⚠️ 40% | argparse in MCP servers |
| atlas | ⚠️ 70% | FastAPI (architectural) |

---

## Cached Docs Reference

All docs checked are in:
- `~/.claude/docs/cache/python/fastapi/README.md`
- `~/.claude/docs/cache/tools/convex/README.md`
- `~/.claude/docs/cache/services/tailscale/README.md`
- `~/.claude/docs/cache/tools/traefik/README.md`

---

*Generated by doc_compliance_scan.py*
*Scan date: 2026-02-07*
